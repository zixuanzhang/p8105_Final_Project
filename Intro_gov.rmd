---
title: "Intro_gov_sj.rmd"
author: "Shan Jiang"
date: "11/24/2018"
output: github_document
---

## Data: May 2017 National Occupational Employment and Wage Estimates United States>

## Salary Prospect From 2017 

```{r}
library(tidyverse)
library(readxl)

```

## Macroeconomic Context
```{r}

national_17 <- read_excel("data/national_10yr/national_2008.xls")

national_17 %>% 

national_17 = national_17 %>% 
              janitor::clean_names() %>% 
              filter(str_detect(occ_code, "^[1][5]") | 
                    occ_title == "All Occupations" | 
                    str_detect(occ_code, "^[1][3]") | 
                    str_detect(occ_code, "^[1][9]")) %>% 
              arrange(desc(tot_emp), a_mean)

## Annual Average comparison for different majors 
national_17 %>% 
              janitor::clean_names() %>% 
              filter(occ_group == "major" | occ_group == "total") %>% 
              mutate(occ_title = as.factor(occ_title)) %>% 
              arrange(desc(tot_emp), a_mean) %>% 
              mutate(CI_salary_low = a_mean - mean_prse, 
                     CI_salary_high = a_mean + mean_prse ) %>% 
  ggplot(aes(occ_title, a_mean)) +
    geom_point() + 
  geom_errorbar(ymax = national_17$a_mean +  national_17$mean_rpse , 
                ymin =  national_17$a_mean -  national_17$mean_rpse) +
  theme_bw() +
  theme(legend.position = "bottom",
        legend.direction = "horizontal",
        axis.text.x = element_text(angle = 90, size = 8),
        legend.key.size = unit(0.05, "cm"))
  
              

national_17 %>% 
filter(occ_code == "13-0000" | 
                    occ_title == "All Occupations" | 
                    occ_code ==  "15-0000" | 
                    occ_code == "19-0000") %>% 
              arrange(desc(tot_emp), a_mean)
  

```

For detetcting the outlook of the computer and math category jobs, we carried out comparison with jobs in some popular fields, such as the 


## Geographical plots and maps 

Import data of state level.

```{r}
state_17 <- read_xlsx("./data/state/oesm17st/state_M2017_dl.xlsx") %>% 
  janitor::clean_names() %>% 
  mutate(a_mean = as.numeric(a_mean)) %>%
  mutate(tot_emp = as.numeric(tot_emp))

## Missing data replaced by mean salary in that specific detailed field for annual salary 
state_df <-  
  state_17 %>% View()
  mutate(a_mean = ifelse(is.na(a_mean), mean(a_mean, na.rm = TRUE), a_mean)) %>% 
  mutate(state = tolower(state))    ## To match the case of state names in 2 dataframe 
```

Then we need to combine the datasets from us.state map and our data.  

```{r}
state_df %>% 
  distinct(state) %>% 
  pull(state) 
```

Since we are making the map of the U.S, we have `nrow(state_17)` entries in our dataset, then we may choose to leave out the data of **Guam**, **Virgin Islands** and the **Puerto Rico** in the convenience of visualization. 

Also, it is far too difficult to create a U.S. state data visualization in R that includes Alaska and Hawaii. 

Then we only keep the computer and mathmatician job classification in our data. 

### spatial map 

```{r}
## Add state salary df.
state_salary <- 
  state_df %>%
  filter(str_detect(occ_code, "15-0000") ) %>% 
  filter(!state %in% c("Puerto Rico","Guam", "Virgin Islands")) %>% 
  group_by(state) %>%
  summarize(abb = st,
            mean_salary = a_mean,
            mean_total = tot_emp,
            mean_job = round(as.numeric(jobs_1000), 2))

```

Now we have `nrow(state_clean)` entries in our dataframe. 

Then we need to generate the geographical information for our dataset. 

```{r}
library(ggplot2)
library(ggmap)
library(fiftystater)
library(plotly)
 
## By using map plotly
states_map <- map_data("state")

state_salary$hover <- 
  with(state_salary, paste(
    "Salary: $", round(mean_salary, 2),'<br>',
            "Total:", mean_total, '<br>',
            "DS Jobs per 1000:", mean_job,'<br>'))

# give state boundaries a white border
l <- list(color = toRGB("white"), width = 2)
# specify some map projection/options
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = TRUE,
  lakecolor = toRGB('white')
)

p <- plot_geo(state_salary, locationmode = 'USA-states') %>%
  add_trace(
    z = ~ mean_salary, text = ~hover, locations = ~ abb,
    color = ~ mean_salary, colors = 'Oranges'
  ) %>%
  colorbar(title = "$:USD") %>%
  layout(
    title = '2017 US Data Science jobs info by State<br>Source: <a href="https://www.bls.gov/oes/tables.htm">BLS</a>',
    titlefont = 8,
    geo = g
  )

```



## Add team logo 
```{r}
sticker(imgurl2, 
        package = "DS Job Outlook", 
        p_size = 6, s_x = 1.05, s_y = 0.75, s_width =.8,
        h_color = "#000000",  p_color = "black",
        filename = "./data/Figures/team_logo2.png")


```


